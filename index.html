<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ロボット掃除機性能検証：データ収集システム</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@400;700&family=Roboto+Mono:wght@500&display=swap');
        :root { --ui-blue:#2b5797; --bg-gray:#f4f4f4; --border-gray:#d1d1d1; --secret-gold:#b2944b;}
        body{background:var(--bg-gray);color:#333;font-family:'Noto Sans JP',sans-serif;line-height:1.6;-webkit-tap-highlight-color:transparent;}
        .report-card{background:#fff;border:1px solid var(--border-gray);border-radius:0;box-shadow:2px 2px 0 rgba(0,0,0,0.05);}
        .header-stripe{height:4px;background:var(--ui-blue);margin-bottom:2rem;}
        .section-title{border-left:4px solid var(--ui-blue);padding-left:.75rem;font-weight:bold;font-size:.9rem;margin-bottom:1.5rem;color:var(--ui-blue);}
        .secret-title{border-left:4px solid var(--secret-gold);color:var(--secret-gold);}
        .input-field{background:#fafafa!important;border:1px solid var(--border-gray)!important;font-size:.85rem!important;}
        .btn-submit{background:var(--ui-blue);color:#fff;font-weight:bold;width:100%;padding:.75rem;border:none;cursor:pointer;}
        .btn-secret{background:var(--secret-gold);}
        .data-label{font-size:.7rem;color:#777;margin-bottom:.25rem;font-weight:bold;display:block;}
        .approval-label{color:#000;}
        .hidden-section{display:none;}
        .modal{display:none;position:fixed;inset:0;background:rgba(0,0,0,.7);backdrop-filter:blur(2px);z-index:100;align-items:center;justify-content:center;padding:10px;}
        .modal-content{background:white;padding:1rem;max-width:750px;width:100%;border:1px solid #000;}
        .confirm-table{width:100%;border-collapse:collapse;font-size:.7rem;margin-bottom:1rem;table-layout:fixed;}
        .confirm-table th{background:#f0f0f0;padding:6px;border:1px solid #ddd;width:100px;color:#555;text-align:center;}
        .confirm-table td{padding:6px;border:1px solid #ddd;font-weight:bold;vertical-align:top;word-break:break-all;}
        .val-col{width:140px;background:#fff;text-align:center;}
        .reason-col{background:#fafafa;}
        .confirm-val-black{color:#000;}
        .msg-box{padding:1rem;margin-top:1rem;font-size:.8rem;font-weight:bold;display:none;text-align:center;border:1px solid transparent;}
        .msg-success{background:#f0fdf4;color:#166534;border-color:#22c55e;}
        .msg-error{background:#fef2f2;color:#991b1b;border-color:#ef4444;font-family:'Roboto Mono',monospace;}
    </style>
</head>
<body class="p-4 md:p-12">

<div class="max-w-3xl mx-auto">
<div class="header-stripe"></div>

<header class="mb-8 flex justify-between items-start">
<div>
<h1 class="text-lg font-bold tracking-tight mb-1">ロボット掃除機 性能評価システム</h1>
<div class="flex items-center space-x-3 text-[9px] text-slate-500 font-mono">
<span id="status" class="text-blue-600 font-bold">ONLINE</span>
<span>V11.2.0</span>
<span id="secretTrigger" class="cursor-pointer hover:underline">PROJECT: CL-RBT-VAL-01</span>
</div>
</div>
<div id="adminIndicator" class="hidden text-[9px] bg-yellow-100 text-yellow-700 px-2 py-1 font-bold">ADMIN</div>
</header>

<!-- ★RemoteConfig追加：お知らせ表示 -->
<div id="announcementBox" class="hidden p-3 mb-6 text-xs border border-blue-300 bg-blue-50 text-blue-800 font-bold text-center"></div>

<section class="report-card p-6">
<h2 class="section-title uppercase tracking-widest">01. 現場評価アンケート</h2>
<form id="surveyForm" class="space-y-6">
<label class="data-label approval-label">導入賛否</label>
<select id="approval" class="w-full p-2 input-field font-bold text-black">
<option value="5">5: 非常に賛成</option>
<option value="4">4: 賛成</option>
<option value="3" selected>3: 普通</option>
<option value="2">2: 反対</option>
<option value="1">1: 非常に反対</option>
</select>
<textarea id="approval_reason" class="w-full p-2 input-field h-16" placeholder="理由を入力"></textarea>
<button type="button" id="surveyBtn" class="btn-submit text-xs uppercase tracking-widest">内容を確認する</button>
<div id="surveyMsg" class="msg-box"></div>
</form>
</section>

<section id="secretSection" class="report-card p-6 hidden-section border-2 border-yellow-200 shadow-md">
<h2 class="section-title secret-title uppercase tracking-widest">02. 管理者物理ログ</h2>
<form id="dustForm">
<input type="number" id="dust_weight" class="w-full p-2 input-field" placeholder="回収重量(g)">
<button type="button" id="dustBtn" class="btn-submit btn-secret text-xs uppercase tracking-widest">物理データを確認</button>
<div id="dustMsg" class="msg-box"></div>
</form>
</section>

</div>

<script>
const SUPABASE_URL='https://speopkpxkpmspuxjgyde.supabase.co';
const SUPABASE_KEY='sb_publishable_ywXntr_4W851vxWRjZ3dPA_uCvLurUu';
const supabaseClient=supabase.createClient(SUPABASE_URL,SUPABASE_KEY);

// ================================
// ★RemoteConfig追加
// ================================

async function loadAppSettings(){
const {data,error}=await supabaseClient.from('app_settings').select('*').eq('id',1).single();
if(error||!data){console.error(error);return;}

// お知らせ
if(data.announcement){
const box=document.getElementById('announcementBox');
box.innerText=data.announcement;
box.classList.remove('hidden');
}

// アンケート受付制御
if(!data.survey_enabled){
const btn=document.getElementById('surveyBtn');
btn.disabled=true;
btn.innerText="現在受付停止中";
btn.style.opacity="0.5";
}

// 管理ログ受付制御
if(!data.dust_enabled){
const btn=document.getElementById('dustBtn');
btn.disabled=true;
btn.innerText="停止中";
btn.style.opacity="0.5";
}

// メンテナンスモード
if(data.maintenance_mode===true){
document.body.innerHTML="<div style='text-align:center;margin-top:120px;font-size:20px;font-weight:bold;'>現在メンテナンス中です</div>";
}
}

loadAppSettings();
</script>

</body>
</html>
